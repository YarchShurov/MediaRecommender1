<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MediaRecommender Complete</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
            transition: transform 0.2s;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .btn-success { background: linear-gradient(135deg, #28a745 0%, #20c997 100%); }
        .btn-warning { background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%); }
        .btn-danger { background: linear-gradient(135deg, #dc3545 0%, #e83e8c 100%); }
        .btn-info { background: linear-gradient(135deg, #17a2b8 0%, #6f42c1 100%); }
        .btn-admin { background: linear-gradient(135deg, #6f42c1 0%, #e83e8c 100%); }
        .btn-small { padding: 6px 12px; font-size: 12px; }

        .user-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f8f9fa;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .user-badge {
            background: #667eea;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        .admin-badge {
            background: #e83e8c;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 20px;
            overflow: hidden;
            flex-wrap: wrap;
        }
        .tab {
            flex: 1;
            min-width: 120px;
            padding: 15px 10px;
            text-align: center;
            cursor: pointer;
            border: none;
            background: transparent;
            font-size: 14px;
            transition: all 0.3s;
        }
        .tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .tab.admin-tab {
            background: linear-gradient(135deg, #6f42c1 0%, #e83e8c 100%);
            color: white;
        }
        .tab.admin-tab.active {
            background: linear-gradient(135deg, #e83e8c 0%, #6f42c1 100%);
        }

        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .content-card {
            border: 2px solid #e9ecef;
            padding: 20px;
            border-radius: 12px;
            background: #f8f9fa;
            transition: all 0.3s;
            position: relative;
        }
        .content-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            border-color: #667eea;
        }
        .content-card h4 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.2em;
        }
        .content-card p {
            color: #666;
            margin-bottom: 8px;
            font-size: 0.9em;
        }
        .rating {
            color: #ffc107;
            font-weight: bold;
        }
        .genres {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin: 10px 0;
        }
        .genre-tag {
            background: #e7f3ff;
            color: #0066cc;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            border: 1px solid #cce7ff;
        }
        .recommendation-badge {
            position: absolute;
            top: -10px;
            right: -10px;
            background: #ff6b6b;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: bold;
        }
        .recommendation-reason {
            background: #e7f3ff;
            padding: 8px;
            border-radius: 6px;
            font-size: 0.8em;
            color: #0066cc;
            margin-bottom: 10px;
            border-left: 3px solid #0066cc;
        }

        .admin-controls {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 10px;
            margin-top: 10px;
        }
        .admin-controls h5 {
            margin: 0 0 10px 0;
            color: #856404;
        }

        .form-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            box-sizing: border-box;
        }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            border-color: #667eea;
            outline: none;
        }

        .rating-section {
            background: #f0f8ff;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
        }
        .rating-slider {
            width: 100%;
            margin: 10px 0;
        }
        .rating-display {
            text-align: center;
            font-size: 1.2em;
            font-weight: bold;
            color: #667eea;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s;
        }
        .stat-card:hover {
            border-color: #667eea;
            transform: scale(1.05);
        }
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
            display: block;
        }
        .stat-label {
            color: #666;
            font-size: 0.9em;
            margin-top: 5px;
        }

        .login-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        .login-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #e9ecef;
        }
        .login-card h3 {
            margin-top: 0;
            color: #333;
        }
        .login-card.admin {
            border-color: #e83e8c;
        }
        .login-card.admin h3 {
            color: #e83e8c;
        }

        .hidden { display: none; }
        .alert {
            padding: 12px 16px;
            margin: 10px 0;
            border-radius: 6px;
            font-size: 14px;
        }
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .alert-info {
            background: #cce7ff;
            color: #004085;
            border: 1px solid #99d6ff;
        }
        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        .loading::after {
            content: "‚è≥";
            font-size: 2em;
            display: block;
            margin-top: 10px;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ–∏—Å–∫–∞ */
        .search-container {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .search-box {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .search-box input {
            flex: 1;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }

        .search-filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .algorithm-explanation {
            background: #fff8e1;
            border-left: 4px solid #ffc107;
            padding: 15px;
            border-radius: 0 8px 8px 0;
            margin: 20px 0;
            font-size: 0.9em;
        }

        .algorithm-step {
            margin: 10px 0;
            padding-left: 15px;
            border-left: 2px solid #ffc107;
        }

        .confidence-meter {
            height: 6px;
            background: #e9ecef;
            border-radius: 3px;
            margin: 5px 0;
            overflow: hidden;
        }

        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #ffc107, #dc3545);
            border-radius: 3px;
        }

        @media (max-width: 768px) {
            .tabs {
                flex-direction: column;
            }
            .tab {
                flex: none;
            }
            .login-section {
                grid-template-columns: 1fr;
            }
            .content-grid {
                grid-template-columns: 1fr;
            }
        }

        .register-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #e9ecef;
        }

        .register-section h4 {
            margin-top: 0;
            color: #333;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ–∏—Å–∫–∞ */
        .search-container {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .search-box {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .search-box input {
            flex: 1;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }

        .search-filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π */
        .user-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .user-card {
            background: white;
            border: 2px solid #e9ecef;
            padding: 15px;
            border-radius: 10px;
            transition: all 0.3s;
        }

        .user-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .user-card h4 {
            margin: 0 0 10px 0;
            color: #333;
        }

        .user-preferences {
            background: #e7f3ff;
            padding: 10px;
            border-radius: 6px;
            font-size: 0.9em;
            margin-top: 10px;
        }

        .preference-bar {
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            margin: 5px 0;
            overflow: hidden;
        }

        .preference-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 4px;
        }

        .user-list {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.user-card {
    background: white;
    border: 2px solid #e9ecef;
    padding: 20px;
    border-radius: 12px;
    transition: all 0.3s;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.user-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    border-color: #667eea;
}

.user-card h4 {
    margin: 0 0 15px 0;
    color: #333;
    font-size: 1.3em;
}

.user-card p {
    margin: 8px 0;
    font-size: 0.95em;
}

.user-preferences {
    background: #f8f9fa;
    padding: 15px;
    border-radius: 8px;
    margin: 15px 0;
    border-left: 4px solid #667eea;
}

.preference-bar {
    height: 8px;
    background: #e9ecef;
    border-radius: 4px;
    margin: 8px 0;
    overflow: hidden;
}

.preference-fill {
    height: 100%;
    background: linear-gradient(90deg, #667eea, #764ba2);
    border-radius: 4px;
}
    </style>
</head>
<body>
    <div class="header">
        <h1>üìö MediaRecommender</h1>
        <p>–£–º–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä–æ–ª–µ–π</p>
    </div>

    <!-- –°–µ–∫—Ü–∏—è –≤—Ö–æ–¥–∞ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
    <div class="container" id="authSection">
        <h2>üîê –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</h2>
        <div id="messages"></div>

        <div class="login-section">
            <div class="login-card">
                <h3>üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</h3>
                <p>–î–æ—Å—Ç—É–ø –∫ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º, –æ—Ü–µ–Ω–∫–∞–º –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ</p>
                <button class="btn btn-success" onclick="quickLogin('testuser', 'test123')">
                    –í–æ–π—Ç–∏ –∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
                </button>
            </div>

            <div class="login-card admin">
                <h3>üëë –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</h3>
                <p>–ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</p>
                <button class="btn btn-admin" onclick="quickLogin('admin', 'admin123')">
                    –í–æ–π—Ç–∏ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
                </button>
            </div>
        </div>

        <div class="form-section">
            <h4>–ò–ª–∏ –≤–≤–µ–¥–∏—Ç–µ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ:</h4>
            <div style="display: grid; grid-template-columns: 1fr 1fr auto; gap: 10px; align-items: end;">
                <div class="form-group">
                    <label>–õ–æ–≥–∏–Ω:</label>
                    <input type="text" id="customUsername" placeholder="–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω">
                </div>
                <div class="form-group">
                    <label>–ü–∞—Ä–æ–ª—å:</label>
                    <input type="password" id="customPassword" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
                </div>
                <button class="btn" onclick="customLogin()">–í–æ–π—Ç–∏</button>
            </div>
        </div>

        <!-- –§–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
        <div class="register-section">
            <h4>üìù –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h4>
            <div class="form-grid">
                <div class="form-group">
                    <label>–õ–æ–≥–∏–Ω:</label>
                    <input type="text" id="registerUsername" placeholder="–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω">
                </div>
                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" id="registerEmail" placeholder="–í–≤–µ–¥–∏—Ç–µ email">
                </div>
                <div class="form-group">
                    <label>–ü–∞—Ä–æ–ª—å:</label>
                    <input type="password" id="registerPassword" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
                </div>
                <div class="form-group">
                    <label>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å:</label>
                    <input type="password" id="registerPasswordConfirm" placeholder="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
                </div>
            </div>
            <button class="btn btn-success" onclick="registerUser()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
        </div>

        <div style="text-align: center; margin-top: 20px;">
            <button class="btn btn-info" onclick="initData()">üîß –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
            <button class="btn btn-warning" onclick="testConnection()">üì° –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Ä–≤–µ—Ä</button>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <div class="container hidden" id="contentSection">
        <div class="user-info">
            <div>
                <h3 style="margin: 0;">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, <span id="userName"></span>!</h3>
                <span id="userRole" class="user-badge"></span>
            </div>
            <div>
                <button class="btn btn-warning" onclick="loadRecommendations()">üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</button>
                <button class="btn btn-info" onclick="loadUserStats()">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
                <button class="btn btn-danger" onclick="logout()">–í—ã–π—Ç–∏</button>
            </div>
        </div>

        <div class="tabs" id="tabsContainer">
            <button class="tab active" onclick="switchTab('recommendations', this)">üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</button>
            <button class="tab" onclick="switchTab('books', this)">üìö –ö–Ω–∏–≥–∏</button>
            <button class="tab" onclick="switchTab('movies', this)">üé¨ –§–∏–ª—å–º—ã</button>
            <button class="tab" onclick="switchTab('games', this)">üéÆ –ò–≥—Ä—ã</button>
            <button class="tab" onclick="switchTab('search', this)">üîç –ü–æ–∏—Å–∫</button>
            <button class="tab" onclick="switchTab('add', this)">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>
            <button class="tab" onclick="switchTab('stats', this)">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
        </div>

        <div id="contentArea">
            <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
    <div class="modal" id="editModal">
        <div class="modal-content">
            <h3>‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç</h3>
            <div id="editForm"></div>
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn btn-success" onclick="saveEdit()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button class="btn btn-danger" onclick="closeModal()">‚ùå –û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –æ—Ü–µ–Ω–∫–∏ -->
    <div class="modal" id="ratingModal">
        <div class="modal-content">
            <h3 id="ratingTitle">‚≠ê –û—Ü–µ–Ω–∏—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç</h3>
            <div class="rating-section">
                <p id="ratingContentInfo"></p>
                <div class="form-group">
                    <label>–í–∞—à–∞ –æ—Ü–µ–Ω–∫–∞ (1-10):</label>
                    <input type="range" id="ratingSlider" class="rating-slider" min="1" max="10" value="5"
                           oninput="updateRatingDisplay()">
                    <div class="rating-display" id="ratingDisplay">5 ‚≠ê</div>
                </div>
            </div>
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn btn-success" onclick="submitRating()">‚úÖ –û—Ü–µ–Ω–∏—Ç—å</button>
                <button class="btn btn-danger" onclick="closeModal()">‚ùå –û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8001';
        let authToken = null;
        let currentUser = null;
        let currentTab = 'recommendations';
        let editingContent = null;
        let ratingContent = null;

        // === –§–£–ù–ö–¶–ò–ò –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò ===
        async function testConnection() {
            try {
                const response = await fetch(`${API_BASE}/`);
                const data = await response.json();
                showMessage('‚úÖ –°–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç: ' + data.message, 'success');
            } catch (error) {
                showMessage('‚ùå –°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 8001', 'error');
            }
        }

        async function initData() {
            try {
                showMessage('üîÑ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö...', 'info');
                const response = await fetch(`${API_BASE}/init-data`);
                const data = await response.json();
                showMessage('‚úÖ ' + data.message, 'success');

                if (data.users) {
                    showMessage(`üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏: ${data.users.user}, üëë –ê–¥–º–∏–Ω: ${data.users.admin}`, 'info');
                }
            } catch (error) {
                showMessage('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ' + error.message, 'error');
            }
        }

        async function quickLogin(username, password) {
            await performLogin(username, password);
        }

        async function customLogin() {
            const username = document.getElementById('customUsername').value;
            const password = document.getElementById('customPassword').value;

            if (!username || !password) {
                showMessage('‚ùå –í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å', 'error');
                return;
            }

            await performLogin(username, password);
        }

        async function performLogin(username, password) {
            try {
                showMessage('üîê –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É...', 'info');

                const formData = new FormData();
                formData.append('username', username);
                formData.append('password', password);

                const response = await fetch(`${API_BASE}/auth/login`, {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (response.ok) {
                    authToken = data.access_token;
                    currentUser = data.user;

                    document.getElementById('userName').textContent = currentUser.username;

                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    const roleElement = document.getElementById('userRole');
                    if (currentUser.role_id === 1) {
                        roleElement.textContent = 'üëë –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä';
                        roleElement.className = 'user-badge admin-badge';
                        showAdminTabs();
                    } else {
                        roleElement.textContent = 'üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
                        roleElement.className = 'user-badge';
                        hideAdminTabs();
                    }

                    document.getElementById('authSection').classList.add('hidden');
                    document.getElementById('contentSection').classList.remove('hidden');

                    showMessage(`‚úÖ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${currentUser.username}!`, 'success');
                    loadRecommendations();
                } else {
                    let errorMessage = '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞';
                    if (data.detail) {
                        if (Array.isArray(data.detail)) {
                            errorMessage = data.detail.map(err => err.msg || err).join(', ');
                        } else {
                            errorMessage = data.detail;
                        }
                    }
                    showMessage('‚ùå –û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ' + errorMessage, 'error');
                }
            } catch (error) {
                showMessage('‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ' + error.message, 'error');
            }
        }

        function showAdminTabs() {
            const tabsContainer = document.getElementById('tabsContainer');

            // –î–æ–±–∞–≤–ª—è–µ–º –∞–¥–º–∏–Ω—Å–∫–∏–µ –≤–∫–ª–∞–¥–∫–∏ –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
            if (!document.getElementById('adminManageTab')) {
                const adminTab = document.createElement('button');
                adminTab.className = 'tab admin-tab';
                adminTab.id = 'adminManageTab';
                adminTab.onclick = () => switchTab('admin-manage', adminTab);
                adminTab.innerHTML = 'üëë –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ';
                tabsContainer.appendChild(adminTab);
            }
        }

        function hideAdminTabs() {
            const adminTab = document.getElementById('adminManageTab');
            if (adminTab) {
                adminTab.remove();
            }
        }

        function logout() {
            authToken = null;
            currentUser = null;
            document.getElementById('authSection').classList.remove('hidden');
            document.getElementById('contentSection').classList.add('hidden');
            document.getElementById('customUsername').value = '';
            document.getElementById('customPassword').value = '';
            showMessage('üëã –í—ã –≤—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã', 'info');
        }

       // === –§–£–ù–ö–¶–ò–ò –ê–î–ú–ò–ù–ò–°–¢–†–ò–†–û–í–ê–ù–ò–Ø ===
        function showAdminPanel() {
    const contentArea = document.getElementById('contentArea');
    contentArea.innerHTML = `
        <h3>üëë –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h3>

        <div class="tabs">
            <button class="tab active" onclick="switchAdminTab('users', this)">üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</button>
            <button class="tab" onclick="switchAdminTab('content', this)">üìö –ö–æ–Ω—Ç–µ–Ω—Ç</button>
            <button class="tab" onclick="switchAdminTab('analytics', this)">üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</button>
        </div>

        <div id="adminContent">
            <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...</div>
        </div>
    `;

    loadAdminUsers();
}

function switchAdminTab(tab, element) {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    element.classList.add('active');

    switch(tab) {
        case 'users':
            loadAdminUsers();
            break;
        case 'content':
            loadAdminContent();
            break;
        case 'analytics':
            loadAdminAnalytics();
            break;
    }
}

// –ó–∞–º–µ–Ω–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é loadAdminUsers() –Ω–∞ —Ä–µ–∞–ª—å–Ω—É—é:

// –ó–∞–º–µ–Ω–∏ —Ñ—É–Ω–∫—Ü–∏—é loadAdminUsers() –Ω–∞:

async function loadAdminUsers() {
    const adminContent = document.getElementById('adminContent');
    adminContent.innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...</div>';

    try {
        const response = await fetch(`${API_BASE}/admin/users`, {
            headers: {
                'Authorization': `Bearer ${authToken}`,
                'Content-Type': 'application/json'
            }
        });

        if (response.ok) {
            const users = await response.json();
            // –î–æ–±–∞–≤–ª—è–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
            const usersWithStats = await Promise.all(users.map(async (user) => {
                // –ü–æ–ª—É—á–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                try {
                    const statsResponse = await fetch(`${API_BASE}/interactions/stats`, {
                        headers: { 'Authorization': `Bearer ${authToken}` }
                    });
                    if (statsResponse.ok) {
                        const stats = await statsResponse.json();
                        return {
                            ...user,
                            total_ratings: stats.total_interactions || 0,
                            last_activity: user.created_at, // –ü–æ–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–∞—Ç—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
                            favorite_genres: [] // –ü–æ–∫–∞ –ø—É—Å—Ç–æ
                        };
                    }
                } catch (e) {
                    console.log('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è', user.user_id);
                }
                return {
                    ...user,
                    total_ratings: 0,
                    last_activity: user.created_at,
                    favorite_genres: []
                };
            }));

            displayAdminUsers(usersWithStats);
        } else {
            const errorData = await response.json();
            throw new Error(errorData.detail || '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π');
        }
    } catch (error) {
        adminContent.innerHTML = `<p>‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ${error.message}</p>`;
    }
}

// –û–±–Ω–æ–≤–∏ —Ñ—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏:

async function blockUser(userId, username) {
    if (!confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${username}?`)) {
        return;
    }

    try {
        const response = await fetch(`${API_BASE}/admin/users/${userId}/block`, {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${authToken}`,
                'Content-Type': 'application/json'
            }
        });

        if (response.ok) {
            showMessage('‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Å–ø–µ—à–Ω–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω', 'success');
            loadAdminUsers(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
        } else {
            const errorData = await response.json();
            showMessage(`‚ùå –û—à–∏–±–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏: ${errorData.detail}`, 'error');
        }
    } catch (error) {
        showMessage(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ${error.message}`, 'error');
    }
}

async function unblockUser(userId, username) {
    if (!confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${username}?`)) {
        return;
    }

    try {
        const response = await fetch(`${API_BASE}/admin/users/${userId}/unblock`, {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${authToken}`,
                'Content-Type': 'application/json'
            }
        });

        if (response.ok) {
            showMessage('‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Å–ø–µ—à–Ω–æ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω', 'success');
            loadAdminUsers(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
        } else {
            const errorData = await response.json();
            showMessage(`‚ùå –û—à–∏–±–∫–∞ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏: ${errorData.detail}`, 'error');
        }
    } catch (error) {
        showMessage(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ${error.message}`, 'error');
    }
}



async function editUserPreferences(userId) {
    // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    try {
        const response = await fetch(`${API_BASE}/admin/users/${userId}`, {
            headers: {
                'Authorization': `Bearer ${authToken}`,
                'Content-Type': 'application/json'
            }
        });

        if (response.ok) {
            const userData = await response.json();
            showEditPreferencesModal(userId, userData.preferences);
        } else {
            showMessage('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è', 'error');
        }
    } catch (error) {
        showMessage(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
    }
}

function showEditPreferencesModal(userId, currentPreferences) {
    // –°–æ–∑–¥–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π
    const modal = document.createElement('div');
    modal.className = 'modal';
    modal.style.display = 'flex';
    modal.innerHTML = `
        <div class="modal-content">
            <h3>‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
            <div class="form-section">
                <div class="form-group">
                    <label>–ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–µ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏ (0-100):</label>
                    <input type="range" id="popularityPref" min="0" max="100" value="${currentPreferences.popularity || 50}"
                           oninput="document.getElementById('popularityValue').textContent = this.value">
                    <div>–ó–Ω–∞—á–µ–Ω–∏–µ: <span id="popularityValue">${currentPreferences.popularity || 50}</span></div>
                </div>
                <div class="form-group">
                    <label>–ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–µ –Ω–æ–≤–∏–∑–Ω—ã (0-100):</label>
                    <input type="range" id="newnessPref" min="0" max="100" value="${currentPreferences.newness || 50}"
                           oninput="document.getElementById('newnessValue').textContent = this.value">
                    <div>–ó–Ω–∞—á–µ–Ω–∏–µ: <span id="newnessValue">${currentPreferences.newness || 50}</span></div>
                </div>
            </div>
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn btn-success" onclick="saveUserPreferences(${userId})">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button class="btn btn-danger" onclick="this.closest('.modal').remove()">‚ùå –û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
}

async function saveUserPreferences(userId) {
    const popularity = document.getElementById('popularityPref').value;
    const newness = document.getElementById('newnessPref').value;

    try {
        const response = await fetch(`${API_BASE}/admin/users/${userId}/preferences`, {
            method: 'PUT',
            headers: {
                'Authorization': `Bearer ${authToken}`,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                preferences: {
                    popularity: parseInt(popularity),
                    newness: parseInt(newness)
                }
            })
        });

        if (response.ok) {
            showMessage('‚úÖ –ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω—ã', 'success');
            document.querySelector('.modal').remove();
            loadAdminUsers(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
        } else {
            const errorData = await response.json();
            showMessage(`‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: ${errorData.detail}`, 'error');
        }
    } catch (error) {
        showMessage(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ${error.message}`, 'error');
    }
}

function displayAdminUsers(users) {
    const adminContent = document.getElementById('adminContent');

    let html = `<h4>–°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (${users.length})</h4>`;
    html += '<div class="user-list">';

    users.forEach(user => {
        html += createUserCard(user);
    });

    html += '</div>';
    adminContent.innerHTML = html;
}

// –û–±–Ω–æ–≤–∏ createUserCard –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ username:

function createUserCard(user) {
    const role = user.role_id === 1 ? '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' : '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
    const roleClass = user.role_id === 1 ? 'admin-badge' : 'user-badge';
    const status = user.is_active ? '–ê–∫—Ç–∏–≤–µ–Ω' : '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω';
    const statusClass = user.is_active ? 'btn-success' : 'btn-danger';

    const favoriteGenres = user.favorite_genres && user.favorite_genres.length > 0 ?
        user.favorite_genres.join(', ') : '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö';
    const lastActivity = user.last_activity ?
        new Date(user.last_activity).toLocaleDateString() : '–ù–∏–∫–æ–≥–¥–∞';

    return `
        <div class="user-card">
            <h4>${user.username}</h4>
            <p><strong>Email:</strong> ${user.email}</p>
            <p><strong>–†–æ–ª—å:</strong> <span class="${roleClass}">${role}</span></p>
            <p><strong>–°—Ç–∞—Ç—É—Å:</strong> <span class="${statusClass}" style="padding: 2px 8px; border-radius: 12px; font-size: 12px;">${status}</span></p>
            <p><strong>–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω:</strong> ${new Date(user.created_at).toLocaleDateString()}</p>
            <p><strong>–ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:</strong> ${lastActivity}</p>
            <p><strong>–í—Å–µ–≥–æ –æ—Ü–µ–Ω–æ–∫:</strong> ${user.total_ratings || 0}</p>

            <div class="user-preferences">
                <p><strong>–ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è:</strong></p>
                <div>–ü–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å: ${user.preferences?.popularity || 50}%</div>
                <div class="preference-bar">
                    <div class="preference-fill" style="width: ${user.preferences?.popularity || 50}%"></div>
                </div>
                <div>–ù–æ–≤–∏–∑–Ω–∞: ${user.preferences?.newness || 50}%</div>
                <div class="preference-bar">
                    <div class="preference-fill" style="width: ${user.preferences?.newness || 50}%"></div>
                </div>
                <p><strong>–õ—é–±–∏–º—ã–µ –∂–∞–Ω—Ä—ã:</strong> ${favoriteGenres}</p>
            </div>

            <div style="margin-top: 15px; display: flex; gap: 5px; flex-wrap: wrap;">
                ${user.role_id !== 1 ? `
                    <button class="btn btn-warning btn-small" onclick="editUserPreferences(${user.user_id}, '${user.username}')">‚úèÔ∏è –ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è</button>
                    <button class="btn btn-info btn-small" onclick="viewUserActivity(${user.user_id})">üìä –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</button>
                    ${user.is_active ?
                        `<button class="btn btn-danger btn-small" onclick="blockUser(${user.user_id}, '${user.username}')">üö´ –ë–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å</button>` :
                        `<button class="btn btn-success btn-small" onclick="unblockUser(${user.user_id}, '${user.username}')">‚úÖ –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å</button>`
                    }
                ` : `
                    <button class="btn btn-info btn-small" onclick="viewUserActivity(${user.user_id})">üìä –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</button>
                `}
            </div>
        </div>
    `;
}

function loadAdminContent() {
    const adminContent = document.getElementById('adminContent');
    adminContent.innerHTML = `
        <h4>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º</h4>
        <div class="alert alert-info">
            –ó–¥–µ—Å—å –±—É–¥–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É–ø—Ä–∞–≤–ª—è—Ç—å –≤—Å–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º —Å–∏—Å—Ç–µ–º—ã
        </div>
        <button class="btn btn-admin" onclick="showBulkAddForm()">üì¶ –ú–∞—Å—Å–æ–≤–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ</button>
    `;
}

function loadAdminAnalytics() {
    const adminContent = document.getElementById('adminContent');
    adminContent.innerHTML = `
        <h4>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã</h4>
        <div class="stats-grid">
            <div class="stat-card">
                <span class="stat-number">2</span>
                <div class="stat-label">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
            </div>
            <div class="stat-card">
                <span class="stat-number">15</span>
                <div class="stat-label">–ö–æ–Ω—Ç–µ–Ω—Ç–∞</div>
            </div>
            <div class="stat-card">
                <span class="stat-number">0</span>
                <div class="stat-label">–û—Ü–µ–Ω–æ–∫</div>
            </div>
        </div>
    `;
}

        // === –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –ù–ê–í–ò–ì–ê–¶–ò–ò ===
        function switchTab(tab, element) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            element.classList.add('active');
            currentTab = tab;

            switch(tab) {
                case 'recommendations':
                    loadRecommendations();
                    break;
                case 'books':
                    loadContent('books');
                    break;
                case 'movies':
                    loadContent('movies');
                    break;
                case 'games':
                    loadContent('games');
                    break;
                case 'search':
                    showSearchForm();
                    break;
                case 'add':
                    showAddContentForm();
                    break;
                case 'stats':
                    loadUserStats();
                    break;
                case 'admin-manage':
                    showAdminPanel();
                    break;
            }
        }

        // === –£–õ–£–ß–®–ï–ù–ù–´–ï –§–£–ù–ö–¶–ò–ò –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ô ===
        async function loadRecommendations() {
            if (!authToken) return;

            document.getElementById('contentArea').innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏...</div>';

            try {
                const response = await fetch(`${API_BASE}/recommendations`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (response.ok) {
                    const data = await response.json();
                    displayRecommendations(data);
                } else {
                    document.getElementById('contentArea').innerHTML = '<p>‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π</p>';
                }
            } catch (error) {
                document.getElementById('contentArea').innerHTML = '<p>‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</p>';
            }
        }

        function displayRecommendations(data) {
            const contentArea = document.getElementById('contentArea');

            let html = '<h3>üéØ –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h3>';

            // –ü–æ—è—Å–Ω–µ–Ω–∏–µ –∞–ª–≥–æ—Ä–∏—Ç–º–∞
            html += `
                <div class="algorithm-explanation">
                    <h4>üìä –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:</h4>
                    <div class="algorithm-step">
                        <strong>1. –ê–Ω–∞–ª–∏–∑ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π:</strong> –°–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≤–∞—à–∏ –æ—Ü–µ–Ω–∫–∏ –∏ –∂–∞–Ω—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ –≤–∞–º –Ω—Ä–∞–≤—è—Ç—Å—è
                    </div>
                    <div class="algorithm-step">
                        <strong>2. –°–æ–≤–ø–∞–¥–µ–Ω–∏–µ –ø–æ –∂–∞–Ω—Ä–∞–º:</strong> –ò—â–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç —Å –ø–æ—Ö–æ–∂–∏–º–∏ –∂–∞–Ω—Ä–∞–º–∏ (–≤–µ—Å: 40%)
                    </div>
                    <div class="algorithm-step">
                        <strong>3. –£—á–µ—Ç –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏:</strong> –£—á–∏—Ç—ã–≤–∞–µ–º –æ–±—â—É—é –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (–≤–µ—Å: 30%)
                    </div>
                    <div class="algorithm-step">
                        <strong>4. –ù–æ–≤–∏–∑–Ω–∞:</strong> –ë–∞–ª–∞–Ω—Å–∏—Ä—É–µ–º –º–µ–∂–¥—É –Ω–æ–≤—ã–º –∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–º –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º (–≤–µ—Å: 20%)
                    </div>
                    <div class="algorithm-step">
                        <strong>5. –°–ª—É—á–∞–π–Ω–æ—Å—Ç—å:</strong> –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–º–Ω–æ–≥–æ —Å–ª—É—á–∞–π–Ω–æ—Å—Ç–∏ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –Ω–æ–≤–æ–≥–æ (–≤–µ—Å: 10%)
                    </div>
                </div>
            `;

            if (data.algorithm_explanation && data.algorithm_explanation.total_interactions > 0) {
                const userStats = data.algorithm_explanation;
                html += `
                    <div class="alert alert-info">
                        üìà –ù–∞ –æ—Å–Ω–æ–≤–µ –≤–∞—à–∏—Ö ${userStats.total_interactions} –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π.
                        –õ—é–±–∏–º—ã–µ –∂–∞–Ω—Ä—ã: ${Object.keys(userStats.genre_preferences || {}).slice(0, 3).join(', ')}
                    </div>
                `;
            } else {
                html += `
                    <div class="alert alert-warning">
                        üåü –û—Ü–µ–Ω–∏—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–π, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏!
                        –°–∏—Å—Ç–µ–º–∞ —Å—Ç–∞–Ω–µ—Ç —Ç–æ—á–Ω–µ–µ —Å –∫–∞–∂–¥—ã–º –≤–∞—à–∏–º –æ—Ç–∑—ã–≤–æ–º.
                    </div>
                `;
            }

            if (data.recommendations && data.recommendations.length > 0) {
                html += '<div class="content-grid">';
                data.recommendations.forEach(item => {
                    html += createContentCard(item, true);
                });
                html += '</div>';
            } else {
                html += '<p>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—Ü–µ–Ω–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–π!</p>';
            }

            contentArea.innerHTML = html;
        }

        // === –£–õ–£–ß–®–ï–ù–ù–´–ô –ü–û–ò–°–ö ===
        function showSearchForm() {
            const contentArea = document.getElementById('contentArea');
            contentArea.innerHTML = `
                <h3>üîç –ü–æ–∏—Å–∫ –∫–æ–Ω—Ç–µ–Ω—Ç–∞</h3>
                <div class="search-container">
                    <div class="search-box">
                        <input type="text" id="searchQuery" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ, –∞–≤—Ç–æ—Ä–∞, –∂–∞–Ω—Ä –∏–ª–∏ —Ç–µ–≥–∏..." onkeypress="if(event.key==='Enter') performSearch()">
                        <button class="btn btn-info" onclick="performSearch()">–ü–æ–∏—Å–∫</button>
                    </div>

                    <div class="search-filters">
                        <div class="form-group">
                            <label>–¢–∏–ø –∫–æ–Ω—Ç–µ–Ω—Ç–∞:</label>
                            <select id="searchType">
                                <option value="all">–í—Å–µ —Ç–∏–ø—ã</option>
                                <option value="book">üìö –ö–Ω–∏–≥–∏</option>
                                <option value="movie">üé¨ –§–∏–ª—å–º—ã</option>
                                <option value="game">üéÆ –ò–≥—Ä—ã</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:</label>
                            <select id="searchSort">
                                <option value="relevance">–ü–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏</option>
                                <option value="popularity">–ü–æ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏</option>
                                <option value="year_desc">–°–Ω–∞—á–∞–ª–∞ –Ω–æ–≤—ã–µ</option>
                                <option value="year_asc">–°–Ω–∞—á–∞–ª–∞ —Å—Ç–∞—Ä—ã–µ</option>
                                <option value="title">–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>–ñ–∞–Ω—Ä:</label>
                            <input type="text" id="searchGenre" placeholder="–§–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞, –î—Ä–∞–º–∞...">
                        </div>

                        <div class="form-group">
                            <label>–ì–æ–¥ –æ—Ç:</label>
                            <input type="number" id="searchYearFrom" placeholder="1800" min="1800" max="2030">
                        </div>

                        <div class="form-group">
                            <label>–ì–æ–¥ –¥–æ:</label>
                            <input type="number" id="searchYearTo" placeholder="2030" min="1800" max="2030">
                        </div>

                        <div class="form-group">
                            <label>–ú–∏–Ω. —Ä–µ–π—Ç–∏–Ω–≥:</label>
                            <input type="number" id="searchMinRating" placeholder="0" min="0" max="10" step="0.1">
                        </div>
                    </div>

                    <button class="btn btn-info" onclick="performSearch()">üîç –ü–æ–∏—Å–∫</button>
                    <button class="btn btn-warning" onclick="clearSearch()">üîÑ –û—á–∏—Å—Ç–∏—Ç—å</button>
                </div>

                <div id="searchResults">
                    <p>–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–∏—Å–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞</p>
                </div>
            `;
        }

        async function performSearch() {
    const query = document.getElementById('searchQuery').value.trim();
    const type = document.getElementById('searchType').value;

    if (!query) {
        showMessage('‚ùå –í–≤–µ–¥–∏—Ç–µ –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å', 'error');
        return;
    }

    document.getElementById('searchResults').innerHTML = '<div class="loading">–ü–æ–∏—Å–∫...</div>';

    try {
        let allResults = [];

        // –ü–æ–∏—Å–∫ –ø–æ –∫–Ω–∏–≥–∞–º
        if (type === 'all' || type === 'book') {
            const booksResponse = await fetch(`${API_BASE}/content/books`, {
                headers: { 'Authorization': `Bearer ${authToken}` }
            });
            if (booksResponse.ok) {
                const books = await booksResponse.json();
                const filteredBooks = books.filter(book =>
                    book.title.toLowerCase().includes(query.toLowerCase()) ||
                    (book.author && book.author.toLowerCase().includes(query.toLowerCase()))
                );
                allResults = allResults.concat(filteredBooks.map(item => ({...item, content_type: 'book'})));
            }
        }

        // –ü–æ–∏—Å–∫ –ø–æ —Ñ–∏–ª—å–º–∞–º
        if (type === 'all' || type === 'movie') {
            const moviesResponse = await fetch(`${API_BASE}/content/movies`, {
                headers: { 'Authorization': `Bearer ${authToken}` }
            });
            if (moviesResponse.ok) {
                const movies = await moviesResponse.json();
                const filteredMovies = movies.filter(movie =>
                    movie.title.toLowerCase().includes(query.toLowerCase()) ||
                    (movie.director && movie.director.toLowerCase().includes(query.toLowerCase()))
                );
                allResults = allResults.concat(filteredMovies.map(item => ({...item, content_type: 'movie'})));
            }
        }

        // –ü–æ–∏—Å–∫ –ø–æ –∏–≥—Ä–∞–º
        if (type === 'all' || type === 'game') {
            const gamesResponse = await fetch(`${API_BASE}/content/games`, {
                headers: { 'Authorization': `Bearer ${authToken}` }
            });
            if (gamesResponse.ok) {
                const games = await gamesResponse.json();
                const filteredGames = games.filter(game =>
                    game.title.toLowerCase().includes(query.toLowerCase()) ||
                    (game.developer && game.developer.toLowerCase().includes(query.toLowerCase()))
                );
                allResults = allResults.concat(filteredGames.map(item => ({...item, content_type: 'game'})));
            }
        }

        displaySearchResults(allResults, query);
    } catch (error) {
        document.getElementById('searchResults').innerHTML = '<p>‚ùå –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞</p>';
    }
}

function displaySearchResults(results, query) {
    const resultsDiv = document.getElementById('searchResults');

    if (results.length === 0) {
        resultsDiv.innerHTML = `<p>üì≠ –ü–æ –∑–∞–ø—Ä–æ—Å—É "${query}" –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>`;
        return;
    }

    let html = `<h4>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ –ø–æ –∑–∞–ø—Ä–æ—Å—É "${query}" (${results.length} –Ω–∞–π–¥–µ–Ω–æ):</h4>`;
    html += '<div class="content-grid">';

    results.forEach(item => {
        html += createContentCard(item, false);
    });

    html += '</div>';
    resultsDiv.innerHTML = html;
}

        function clearSearch() {
            document.getElementById('searchQuery').value = '';
            document.getElementById('searchType').value = 'all';
            document.getElementById('searchSort').value = 'relevance';
            document.getElementById('searchGenre').value = '';
            document.getElementById('searchYearFrom').value = '';
            document.getElementById('searchYearTo').value = '';
            document.getElementById('searchMinRating').value = '';
            document.getElementById('searchResults').innerHTML = '<p>–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–∏—Å–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞</p>';
        }

        // === –§–£–ù–ö–¶–ò–ò –ó–ê–ì–†–£–ó–ö–ò –ö–û–ù–¢–ï–ù–¢–ê ===
        async function loadContent(type) {
            if (!authToken) return;

            document.getElementById('contentArea').innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç...</div>';

            try {
                const response = await fetch(`${API_BASE}/content/${type}`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (response.ok) {
                    const content = await response.json();
                    displayContent(content, type);
                } else {
                    document.getElementById('contentArea').innerHTML = '<p>‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞</p>';
                }
            } catch (error) {
                document.getElementById('contentArea').innerHTML = '<p>‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</p>';
            }
        }

        function displayContent(items, type) {
            const contentArea = document.getElementById('contentArea');

            if (items.length === 0) {
                contentArea.innerHTML = `<p>üì≠ ${getTypeTitle(type)} –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>`;
                return;
            }

            let html = `<h3>${getTypeIcon(type)} ${getTypeTitle(type)} (${items.length})</h3>`;
            html += '<div class="content-grid">';

            items.forEach(item => {
                html += createContentCard(item, false);
            });

            html += '</div>';
            contentArea.innerHTML = html;
        }

        function createContentCard(item, isRecommendation = false) {
            const genres = Array.isArray(item.genres) ? item.genres : (item.genre ? [item.genre] : []);
            const genresHtml = genres.map(g => `<span class="genre-tag">${g}</span>`).join('');

            let card = `
                <div class="content-card">
                    ${isRecommendation ? '<div class="recommendation-badge">–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º</div>' : ''}
                    <h4>${item.title}</h4>
                    <p><strong>${getCreatorLabel(item.content_type)}:</strong> ${item.creator}</p>
                    <div class="genres">${genresHtml}</div>
                    <p><strong>–ì–æ–¥:</strong> ${item.year || '–ù–µ —É–∫–∞–∑–∞–Ω'}</p>
                    <p class="rating">‚≠ê ${item.popularity_score.toFixed(1)}</p>
            `;

            if (isRecommendation && item.explanation) {
                card += `
                    <div class="recommendation-reason">
                        <strong>–ü–æ—á–µ–º—É —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º:</strong> ${item.explanation.primary_reason}
                        ${item.confidence ? `<br><small>–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: ${item.confidence.toFixed(1)}%</small>
                        <div class="confidence-meter">
                            <div class="confidence-fill" style="width: ${item.confidence}%"></div>
                        </div>` : ''}
                    </div>
                `;
            }

            card += `
                    <div style="margin-top: 15px;">
                        <button class="btn btn-success btn-small" onclick="startActivity('${item.content_type}', ${item.id}, '${item.title}')">
                            ${getActionText(item.content_type)}
                        </button>
                        <button class="btn btn-info btn-small" onclick="openRatingModal('${item.content_type}', ${item.id}, '${item.title}')">
                            ‚≠ê –û—Ü–µ–Ω–∏—Ç—å
                        </button>
                    </div>
            `;

            // –ê–¥–º–∏–Ω—Å–∫–∏–µ –∫–Ω–æ–ø–∫–∏
            if (currentUser && currentUser.role_id === 1) {
                card += `
                    <div class="admin-controls">
                        <h5>üëë –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h5>
                        <button class="btn btn-warning btn-small" onclick="openEditModal('${item.content_type}', ${item.id})">
                            ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                        </button>
                        <button class="btn btn-danger btn-small" onclick="deleteContent('${item.content_type}', ${item.id}, '${item.title}')">
                            üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                        </button>
                    </div>
                `;
            }

            card += '</div>';
            return card;
        }

        // === –§–£–ù–ö–¶–ò–ò –í–ó–ê–ò–ú–û–î–ï–ô–°–¢–í–ò–Ø –° –ö–û–ù–¢–ï–ù–¢–û–ú ===
        async function startActivity(contentType, contentId, title) {
            showMessage(`üöÄ –ù–∞—á–∏–Ω–∞–µ–º ${getActivityName(contentType)} "${title}"...`, 'info');

            try {
                const response = await fetch(`${API_BASE}/simulation/start`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        content_type: contentType,
                        content_id: contentId
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    showMessage('‚úÖ ' + data.message, 'success');

                    // –°–∏–º—É–ª—è—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —á–µ—Ä–µ–∑ —Å–ª—É—á–∞–π–Ω–æ–µ –≤—Ä–µ–º—è (3-8 —Å–µ–∫—É–Ω–¥ –¥–ª—è –¥–µ–º–æ)
                    const simulationTime = Math.random() * 5000 + 3000;
                    setTimeout(() => {
                        completeActivity(data.simulation_id, title);
                    }, simulationTime);
                } else {
                    const errorData = await response.json();
                    showMessage('‚ùå –û—à–∏–±–∫–∞ —Å–∏–º—É–ª—è—Ü–∏–∏: ' + errorData.detail, 'error');
                }
            } catch (error) {
                showMessage('‚ùå –û—à–∏–±–∫–∞: ' + error.message, 'error');
            }
        }

        async function completeActivity(simulationId, title) {
            try {
                const rating = Math.floor(Math.random() * 4) + 7; // –°–ª—É—á–∞–π–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ 7-10

                const response = await fetch(`${API_BASE}/simulation/complete/${simulationId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({ rating: rating })
                });

                if (response.ok) {
                    const data = await response.json();
                    showMessage(`üéâ ${data.message} –ü–æ–ª—É—á–µ–Ω–æ ${data.experience} –æ–ø—ã—Ç–∞! –û—Ü–µ–Ω–∫–∞: ${rating}/10`, 'success');

                    // –ï—Å–ª–∏ –º—ã –Ω–∞ –≤–∫–ª–∞–¥–∫–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π, –æ–±–Ω–æ–≤–ª—è–µ–º –∏—Ö
                    if (currentTab === 'recommendations') {
                        setTimeout(() => {
                            loadRecommendations();
                        }, 2000);
                    }
                } else {
                    const errorData = await response.json();
                    showMessage('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è: ' + errorData.detail, 'error');
                }
            } catch (error) {
                showMessage('‚ùå –û—à–∏–±–∫–∞: ' + error.message, 'error');
            }
        }

        // === –§–£–ù–ö–¶–ò–ò –û–¶–ï–ù–ö–ò ===
        function openRatingModal(contentType, contentId, title) {
            ratingContent = { type: contentType, id: contentId, title: title };

            document.getElementById('ratingTitle').textContent = `‚≠ê –û—Ü–µ–Ω–∏—Ç—å: ${title}`;
            document.getElementById('ratingContentInfo').textContent = `–û—Ü–µ–Ω–∏—Ç–µ "${title}" –æ—Ç 1 –¥–æ 10 –∑–≤–µ–∑–¥`;
            document.getElementById('ratingSlider').value = 5;
            updateRatingDisplay();

            document.getElementById('ratingModal').style.display = 'flex';
        }

        function updateRatingDisplay() {
            const rating = document.getElementById('ratingSlider').value;
            const stars = '‚≠ê'.repeat(Math.min(rating, 5)) + (rating > 5 ? `+${rating-5}` : '');
            document.getElementById('ratingDisplay').textContent = `${rating} ${stars}`;
        }

        async function submitRating() {
            if (!ratingContent) return;

            const rating = parseInt(document.getElementById('ratingSlider').value);

            try {
                const response = await fetch(`${API_BASE}/rate-content?content_type=${ratingContent.type}&content_id=${ratingContent.id}&rating=${rating}`, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (response.ok) {
                    const data = await response.json();
                    showMessage(`‚úÖ ${data.message}. –ù–æ–≤–∞—è –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å: ${data.new_popularity}`, 'success');
                    closeModal();

                    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â—É—é –≤–∫–ª–∞–¥–∫—É
                    if (currentTab === 'recommendations') {
                        loadRecommendations();
                    } else if (['books', 'movies', 'games'].includes(currentTab)) {
                        loadContent(currentTab);
                    } else if (currentTab === 'search') {
                        performSearch(); // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º –ø–æ–∏—Å–∫ –µ—Å–ª–∏ –º—ã –Ω–∞ –≤–∫–ª–∞–¥–∫–µ –ø–æ–∏—Å–∫–∞
                    }
                } else {
                    const errorData = await response.json();
                    showMessage('‚ùå –û—à–∏–±–∫–∞ –æ—Ü–µ–Ω–∫–∏: ' + errorData.detail, 'error');
                }
            } catch (error) {
                showMessage('‚ùå –û—à–∏–±–∫–∞: ' + error.message, 'error');
            }
        }

        // === –§–£–ù–ö–¶–ò–ò –î–û–ë–ê–í–õ–ï–ù–ò–Ø –ö–û–ù–¢–ï–ù–¢–ê ===
        function showAddContentForm() {
            const contentArea = document.getElementById('contentArea');
            contentArea.innerHTML = `
                <h3>‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç</h3>
                <div class="form-section">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>–¢–∏–ø –∫–æ–Ω—Ç–µ–Ω—Ç–∞:</label>
                            <select id="addContentType">
                                <option value="book">üìö –ö–Ω–∏–≥–∞</option>
                                <option value="movie">üé¨ –§–∏–ª—å–º</option>
                                <option value="game">üéÆ –ò–≥—Ä–∞</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>–ù–∞–∑–≤–∞–Ω–∏–µ:</label>
                            <input type="text" id="addTitle" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ">
                        </div>
                        <div class="form-group">
                            <label>–ê–≤—Ç–æ—Ä/–†–µ–∂–∏—Å—Å–µ—Ä/–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫:</label>
                            <input type="text" id="addCreator" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è —Å–æ–∑–¥–∞—Ç–µ–ª—è">
                        </div>
                        <div class="form-group">
                            <label>–ñ–∞–Ω—Ä—ã (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é):</label>
                            <input type="text" id="addGenres" placeholder="–§–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞, –ü—Ä–∏–∫–ª—é—á–µ–Ω–∏—è, –î—Ä–∞–º–∞">
                        </div>
                        <div class="form-group">
                            <label>–ì–æ–¥:</label>
                            <input type="number" id="addYear" placeholder="2024" min="1800" max="2030">
                        </div>
                        <div class="form-group">
                            <label>–ü–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å (0-10):</label>
                            <input type="number" id="addPopularity" placeholder="5.0" min="0" max="10" step="0.1" value="5.0">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>–û–ø–∏—Å–∞–Ω–∏–µ:</label>
                        <textarea id="addDescription" placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞" rows="3"></textarea>
                    </div>
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="btn btn-success" onclick="addNewContent()">‚úÖ –î–æ–±–∞–≤–∏—Ç—å</button>
                        <button class="btn btn-warning" onclick="clearAddForm()">üîÑ –û—á–∏—Å—Ç–∏—Ç—å</button>
                    </div>
                </div>

                <div class="alert alert-info">
                    üí° <strong>–°–æ–≤–µ—Ç:</strong> –î–æ–±–∞–≤–ª—è–π—Ç–µ –∂–∞–Ω—Ä—ã —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é –¥–ª—è –ª—É—á—à–∏—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π.
                    –ù–∞–ø—Ä–∏–º–µ—Ä: "–§–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞, –ü—Ä–∏–∫–ª—é—á–µ–Ω–∏—è, –î—Ä–∞–º–∞"
                </div>
            `;
        }

        async function addNewContent() {
            const contentType = document.getElementById('addContentType').value;
            const title = document.getElementById('addTitle').value;
            const creator = document.getElementById('addCreator').value;
            const genres = document.getElementById('addGenres').value;
            const year = document.getElementById('addYear').value;
            const popularity = document.getElementById('addPopularity').value;
            const description = document.getElementById('addDescription').value;

            if (!title || !creator) {
                showMessage('‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è: –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ —Å–æ–∑–¥–∞—Ç–µ–ª—å', 'error');
                return;
            }

            try {
                const params = new URLSearchParams({
                    content_type: contentType,
                    title: title,
                    creator: creator
                });

                if (genres) params.append('genres', genres);
                if (year) params.append('year', year);
                if (popularity) params.append('popularity_score', popularity);
                if (description) params.append('description', description);

                const response = await fetch(`${API_BASE}/admin/add-content?${params}`, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (response.ok) {
                    const data = await response.json();
                    showMessage('‚úÖ ' + data.message, 'success');
                    clearAddForm();
                } else {
                    const errorData = await response.json();
                    showMessage('‚ùå –û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è: ' + errorData.detail, 'error');
                }
            } catch (error) {
                showMessage('‚ùå –û—à–∏–±–∫–∞: ' + error.message, 'error');
            }
        }

        function clearAddForm() {
            document.getElementById('addTitle').value = '';
            document.getElementById('addCreator').value = '';
            document.getElementById('addGenres').value = '';
            document.getElementById('addYear').value = '';
            document.getElementById('addPopularity').value = '5.0';
            document.getElementById('addDescription').value = '';
        }

        // === –§–£–ù–ö–¶–ò–ò –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø (–ê–î–ú–ò–ù) ===
        async function openEditModal(contentType, contentId) {
            if (currentUser.role_id !== 1) {
                showMessage('‚ùå –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω. –¢—Ä–µ–±—É—é—Ç—Å—è –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.', 'error');
                return;
            }

            // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
            try {
                const response = await fetch(`${API_BASE}/content/${contentType}s`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (response.ok) {
                    const items = await response.json();
                    const item = items.find(i => i.id === contentId);

                    if (item) {
                        editingContent = { type: contentType, id: contentId, data: item };
                        showEditForm(item);
                    }
                }
            } catch (error) {
                showMessage('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è', 'error');
            }
        }

        function showEditForm(item) {
            const genres = Array.isArray(item.genres) ? item.genres.join(', ') : (item.genre || '');

            document.getElementById('editForm').innerHTML = `
                <div class="form-grid">
                    <div class="form-group">
                        <label>–ù–∞–∑–≤–∞–Ω–∏–µ:</label>
                        <input type="text" id="editTitle" value="${item.title}">
                    </div>
                    <div class="form-group">
                        <label>${getCreatorLabel(item.content_type)}:</label>
                        <input type="text" id="editCreator" value="${item.creator}">
                    </div>
                    <div class="form-group">
                        <label>–ñ–∞–Ω—Ä—ã (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é):</label>
                        <input type="text" id="editGenres" value="${genres}">
                    </div>
                    <div class="form-group">
                        <label>–ì–æ–¥:</label>
                        <input type="number" id="editYear" value="${item.year || ''}" min="1800" max="2030">
                    </div>
                    <div class="form-group">
                        <label>–ü–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å (0-10):</label>
                        <input type="number" id="editPopularity" value="${item.popularity_score}" min="0" max="10" step="0.1">
                    </div>
                </div>
                <div class="form-group">
                    <label>–û–ø–∏—Å–∞–Ω–∏–µ:</label>
                    <textarea id="editDescription" rows="3">${item.description || ''}</textarea>
                </div>
            `;

            document.getElementById('editModal').style.display = 'flex';
        }

        async function saveEdit() {
            if (!editingContent) return;

            const title = document.getElementById('editTitle').value;
            const creator = document.getElementById('editCreator').value;
            const genres = document.getElementById('editGenres').value;
            const year = document.getElementById('editYear').value;
            const popularity = document.getElementById('editPopularity').value;
            const description = document.getElementById('editDescription').value;

            try {
                const params = new URLSearchParams();
                if (title) params.append('title', title);
                if (creator) params.append('creator', creator);
                if (genres) params.append('genres', genres);
                if (year) params.append('year', year);
                if (popularity) params.append('popularity_score', popularity);
                if (description) params.append('description', description);

                const response = await fetch(`${API_BASE}/admin/edit-content/${editingContent.type}/${editingContent.id}?${params}`, {
                    method: 'PUT',
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (response.ok) {
                    const data = await response.json();
                    showMessage('‚úÖ ' + data.message, 'success');
                    closeModal();

                    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â—É—é –≤–∫–ª–∞–¥–∫—É
                    if (['books', 'movies', 'games'].includes(currentTab)) {
                        loadContent(currentTab);
                    } else if (currentTab === 'search') {
                        performSearch();
                    }
                } else {
                    const errorData = await response.json();
                    showMessage('‚ùå –û—à–∏–±–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: ' + errorData.detail, 'error');
                }
            } catch (error) {
                showMessage('‚ùå –û—à–∏–±–∫–∞: ' + error.message, 'error');
            }
        }

        async function deleteContent(contentType, contentId, title) {
            if (currentUser.role_id !== 1) {
                showMessage('‚ùå –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω. –¢—Ä–µ–±—É—é—Ç—Å—è –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.', 'error');
                return;
            }

            if (!confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å "${title}"?`)) {
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/admin/delete-content/${contentType}/${contentId}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (response.ok) {
                    const data = await response.json();
                    showMessage('‚úÖ ' + data.message, 'success');

                    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â—É—é –≤–∫–ª–∞–¥–∫—É
                    if (['books', 'movies', 'games'].includes(currentTab)) {
                        loadContent(currentTab);
                    } else if (currentTab === 'search') {
                        performSearch();
                    }
                } else {
                    const errorData = await response.json();
                    showMessage('‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ' + errorData.detail, 'error');
                }
            } catch (error) {
                showMessage('‚ùå –û—à–∏–±–∫–∞: ' + error.message, 'error');
            }
        }

        // === –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–¨ ===
        function showAdminPanel() {
            const contentArea = document.getElementById('contentArea');
            contentArea.innerHTML = `
                <h3>üëë –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h3>

                <div class="stats-grid">
                    <div class="stat-card">
                        <span class="stat-number" id="totalUsers">-</span>
                        <div class="stat-label">üë• –í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number" id="totalContent">-</span>
                        <div class="stat-label">üìö –í—Å–µ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞</div>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number" id="totalRatings">-</span>
                        <div class="stat-label">‚≠ê –í—Å–µ–≥–æ –æ—Ü–µ–Ω–æ–∫</div>
                    </div>
                </div>

                <div class="form-section">
                    <h4>üöÄ –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <button class="btn btn-admin" onclick="showBulkAddForm()">üì¶ –ú–∞—Å—Å–æ–≤–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ</button>
                        <button class="btn btn-warning" onclick="showPopularityManager()">üìà –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å—é</button>
                        <button class="btn btn-info" onclick="showGenreAnalytics()">üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∂–∞–Ω—Ä–æ–≤</button>
                        <button class="btn btn-success" onclick="exportData()">üíæ –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</button>
                    </div>
                </div>

                <div class="alert alert-warning">
                    ‚ö†Ô∏è <strong>–í–Ω–∏–º–∞–Ω–∏–µ:</strong> –í—ã –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å –≤ —Ä–µ–∂–∏–º–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.
                    –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–ª–∏—è—é—Ç –Ω–∞ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å–∏—Å—Ç–µ–º—ã.
                </div>

                <div id="adminContent">
                    <p>–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ –≤—ã—à–µ –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã.</p>
                </div>
            `;

            loadAdminStats();
        }

        async function loadAdminStats() {
            // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –¥–ª—è –∞–¥–º–∏–Ω–∞
            // –ü–æ–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º –∑–∞–≥–ª—É—à–∫–∏
            document.getElementById('totalUsers').textContent = '2';
            document.getElementById('totalContent').textContent = '15';
            document.getElementById('totalRatings').textContent = '0';
        }

        function showBulkAddForm() {
            const adminContent = document.getElementById('adminContent');
            adminContent.innerHTML = `
                <h4>üì¶ –ú–∞—Å—Å–æ–≤–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞</h4>
                <div class="form-section">
                    <div class="alert alert-info">
                        –î–æ–±–∞–≤—å—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ. –ö–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ - –æ—Ç–¥–µ–ª—å–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç.
                        –§–æ—Ä–º–∞—Ç: –¢–∏–ø|–ù–∞–∑–≤–∞–Ω–∏–µ|–°–æ–∑–¥–∞—Ç–µ–ª—å|–ñ–∞–Ω—Ä—ã|–ì–æ–¥|–ü–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å|–û–ø–∏—Å–∞–Ω–∏–µ
                    </div>
                    <div class="form-group">
                        <label>–î–∞–Ω–Ω—ã–µ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è:</label>
                        <textarea id="bulkData" rows="10" placeholder="book|–ì–∞—Ä—Ä–∏ –ü–æ—Ç—Ç–µ—Ä 2|–î–∂.–ö. –†–æ—É–ª–∏–Ω–≥|–§—ç–Ω—Ç–µ–∑–∏,–ü—Ä–∏–∫–ª—é—á–µ–Ω–∏—è|1998|9.0|–í—Ç–æ—Ä–∞—è —á–∞—Å—Ç—å —Å–µ—Ä–∏–∏
movie|–ú–∞—Ç—Ä–∏—Ü–∞ 2|–ë—Ä–∞—Ç—å—è –í–∞—á–æ–≤—Å–∫–∏|–§–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞,–≠–∫—à–µ–Ω|2003|8.5|–ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –∫—É–ª—å—Ç–æ–≤–æ–≥–æ —Ñ–∏–ª—å–º–∞
game|Witcher 4|CD Projekt RED|RPG,–§—ç–Ω—Ç–µ–∑–∏|2025|8.0|–ù–æ–≤–∞—è —á–∞—Å—Ç—å —Å–µ—Ä–∏–∏"></textarea>
                    </div>
                    <button class="btn btn-success" onclick="processBulkAdd()">‚úÖ –î–æ–±–∞–≤–∏—Ç—å –≤—Å–µ</button>
                </div>
            `;
        }

        async function processBulkAdd() {
            const bulkData = document.getElementById('bulkData').value;
            const lines = bulkData.split('\n').filter(line => line.trim());

            let successCount = 0;
            let errorCount = 0;

            for (const line of lines) {
                const parts = line.split('|').map(p => p.trim());
                if (parts.length < 3) continue;

                const [type, title, creator, genres = '', year = '', popularity = '5.0', description = ''] = parts;

                try {
                    const params = new URLSearchParams({
                        content_type: type,
                        title: title,
                        creator: creator
                    });

                    if (genres) params.append('genres', genres);
                    if (year) params.append('year', year);
                    if (popularity) params.append('popularity_score', popularity);
                    if (description) params.append('description', description);

                    const response = await fetch(`${API_BASE}/admin/add-content?${params}`, {
                        method: 'POST',
                        headers: { 'Authorization': `Bearer ${authToken}` }
                    });

                    if (response.ok) {
                        successCount++;
                    } else {
                        errorCount++;
                    }
                } catch (error) {
                    errorCount++;
                }
            }

            showMessage(`‚úÖ –ú–∞—Å—Å–æ–≤–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ: ${successCount} —É—Å–ø–µ—à–Ω–æ, ${errorCount} –æ—à–∏–±–æ–∫`, 'success');
            document.getElementById('bulkData').value = '';
        }

        // === –§–£–ù–ö–¶–ò–ò –°–¢–ê–¢–ò–°–¢–ò–ö–ò ===
        async function loadUserStats() {
            if (!authToken) return;

            document.getElementById('contentArea').innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É...</div>';

            try {
                const response = await fetch(`${API_BASE}/user/stats`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (response.ok) {
                    const stats = await response.json();
                    displayStats(stats);
                } else {
                    document.getElementById('contentArea').innerHTML = '<p>‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏</p>';
                }
            } catch (error) {
                document.getElementById('contentArea').innerHTML = '<p>‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</p>';
            }
        }

        function displayStats(stats) {
            const contentArea = document.getElementById('contentArea');

            const html = `
                <h3>üìä –í–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                <div class="stats-grid">
                    <div class="stat-card">
                        <span class="stat-number">${stats.total_interactions}</span>
                        <div class="stat-label">–í—Å–µ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π</div>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number">${stats.completed}</span>
                        <div class="stat-label">–ó–∞–≤–µ—Ä—à–µ–Ω–æ</div>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number">${stats.average_rating}</span>
                        <div class="stat-label">–°—Ä–µ–¥–Ω—è—è –æ—Ü–µ–Ω–∫–∞</div>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number">${stats.by_content_type.books}</span>
                        <div class="stat-label">üìö –ö–Ω–∏–≥ –ø—Ä–æ—á–∏—Ç–∞–Ω–æ</div>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number">${stats.by_content_type.movies}</span>
                        <div class="stat-label">üé¨ –§–∏–ª—å–º–æ–≤ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–æ</div>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number">${stats.by_content_type.games}</span>
                        <div class="stat-label">üéÆ –ò–≥—Ä –ø—Ä–æ–π–¥–µ–Ω–æ</div>
                    </div>
                </div>

                <div class="alert alert-info" style="margin-top: 20px;">
                    üí° <strong>–°–æ–≤–µ—Ç:</strong> –ß–µ–º –±–æ–ª—å—à–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –≤—ã –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç–µ, —Ç–µ–º —Ç–æ—á–Ω–µ–µ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏!
                    ${stats.total_interactions === 0 ? ' –ù–∞—á–Ω–∏—Ç–µ —Å –æ—Ü–µ–Ω–∫–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–π.' : ''}
                </div>

                ${stats.completed > 0 ? `
                <div class="form-section">
                    <h4>üéØ –í–∞—à –ø—Ä–æ—Ñ–∏–ª—å –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π</h4>
                    <p>–ù–∞ –æ—Å–Ω–æ–≤–µ –≤–∞—à–∏—Ö ${stats.completed} –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π —Å–∏—Å—Ç–µ–º–∞ –∏–∑—É—á–∞–µ—Ç –≤–∞—à–∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è
                    –∏ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏.</p>
                </div>
                ` : ''}
            `;

            contentArea.innerHTML = html;
        }

        // === –§–£–ù–ö–¶–ò–ò –†–ï–ì–ò–°–¢–†–ê–¶–ò–ò ===
        async function registerUser() {
            const username = document.getElementById('registerUsername').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const passwordConfirm = document.getElementById('registerPasswordConfirm').value;

            // –í–∞–ª–∏–¥–∞—Ü–∏—è
            if (!username || !email || !password) {
                showMessage('‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è', 'error');
                return;
            }

            if (password !== passwordConfirm) {
                showMessage('‚ùå –ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç', 'error');
                return;
            }

            if (password.length < 6) {
                showMessage('‚ùå –ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤', 'error');
                return;
            }

            try {
                showMessage('üìù –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...', 'info');

                const response = await fetch(`${API_BASE}/auth/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        username: username,
                        email: email,
                        password: password
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    showMessage(`‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${data.username} —É—Å–ø–µ—à–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω! –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –≤–æ–π—Ç–∏.`, 'success');

                    // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
                    document.getElementById('registerUsername').value = '';
                    document.getElementById('registerEmail').value = '';
                    document.getElementById('registerPassword').value = '';
                    document.getElementById('registerPasswordConfirm').value = '';
                } else {
                    const errorData = await response.json();
                    let errorMessage = '–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏';
                    if (errorData.detail) {
                        if (Array.isArray(errorData.detail)) {
                            errorMessage = errorData.detail.map(err => err.msg || err).join(', ');
                        } else {
                            errorMessage = errorData.detail;
                        }
                    }
                    showMessage('‚ùå ' + errorMessage, 'error');
                }
            } catch (error) {
                showMessage('‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ' + error.message, 'error');
            }
        }

        // === –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ===
        function closeModal() {
            document.getElementById('editModal').style.display = 'none';
            document.getElementById('ratingModal').style.display = 'none';
            editingContent = null;
            ratingContent = null;
        }

        function getTypeIcon(type) {
            const icons = { 'books': 'üìö', 'movies': 'üé¨', 'games': 'üéÆ' };
            return icons[type] || 'üìÑ';
        }

        function getTypeTitle(type) {
            const titles = { 'books': '–ö–Ω–∏–≥–∏', 'movies': '–§–∏–ª—å–º—ã', 'games': '–ò–≥—Ä—ã' };
            return titles[type] || type;
        }

        function getCreatorLabel(type) {
            const labels = {
                'book': '–ê–≤—Ç–æ—Ä', 'books': '–ê–≤—Ç–æ—Ä',
                'movie': '–†–µ–∂–∏—Å—Å–µ—Ä', 'movies': '–†–µ–∂–∏—Å—Å–µ—Ä',
                'game': '–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫', 'games': '–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫'
            };
            return labels[type] || '–°–æ–∑–¥–∞—Ç–µ–ª—å';
        }

        function getActionText(type) {
            const actions = {
                'book': 'üìñ –ß–∏—Ç–∞—Ç—å', 'books': 'üìñ –ß–∏—Ç–∞—Ç—å',
                'movie': 'üé¨ –°–º–æ—Ç—Ä–µ—Ç—å', 'movies': 'üé¨ –°–º–æ—Ç—Ä–µ—Ç—å',
                'game': 'üéÆ –ò–≥—Ä–∞—Ç—å', 'games': 'üéÆ –ò–≥—Ä–∞—Ç—å'
            };
            return actions[type] || '–ù–∞—á–∞—Ç—å';
        }

        function getActivityName(type) {
            const names = {
                'book': '—á—Ç–µ–Ω–∏–µ', 'books': '—á—Ç–µ–Ω–∏–µ',
                'movie': '–ø—Ä–æ—Å–º–æ—Ç—Ä', 'movies': '–ø—Ä–æ—Å–º–æ—Ç—Ä',
                'game': '–∏–≥—Ä—É', 'games': '–∏–≥—Ä—É'
            };
            return names[type] || '–≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ';
        }

        function showMessage(message, type) {
            const messagesDiv = document.getElementById('messages');
            messagesDiv.innerHTML = `<div class="alert alert-${type}">${message}</div>`;

            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                if (messagesDiv.innerHTML.includes(message)) {
                    messagesDiv.innerHTML = '';
                }
            }, 5000);
        }

        // === –°–û–ë–´–¢–ò–Ø ===
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –∏—Ö
        window.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal')) {
                closeModal();
            }
        });

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –ø–æ ESC
        window.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeModal();
            }
        });

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            testConnection();
        });
    </script>
</body>
</html>